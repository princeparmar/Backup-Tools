package main

import (
	"context"
	"encoding/json"

	"github.com/StorX2-0/Backup-Tools/apps/google"
	"github.com/StorX2-0/Backup-Tools/logger"
	"google.golang.org/api/gmail/v1"
)

func main() {
	googleToken := "ya29.a0AeDClZAO16NEAcq_ItMxHHEnAQBcXk3UI1YSa2jvLnkxvU99f_lbaJr9w9dcpawhtkmdVF7h138D4SdmmNAarfCYgerpE0C8Hk-yOb62VU-hivgepGIPoohMmbHVthdim_iIBkgJE1o-aRCyfT7g5Cx41lIczxICRqgLnW7IaCgYKAcgSARMSFQHGX2MiA81yXLiU9O_VHw_0hCLj7A0175"

	gmailClient, err := google.NewGmailClientUsingToken(googleToken)
	if err != nil {
		panic("auth error: " + err.Error())
	}

	// Your example message JSON
	messageJSON := `{"historyId":"11034008","id":"15d133f50ae4d1c4","internalDate":"1499266501000","labelIds":["IMPORTANT","CATEGORY_PERSONAL","INBOX"],"payload":{"body":{},"headers":[{"name":"Delivered-To","value":"prince.soamedia@gmail.com"},{"name":"Received","value":"by 10.103.144.87 with SMTP id s84csp952649vsd;        Wed, 5 Jul 2017 07:55:02 -0700 (PDT)"},{"name":"X-Received","value":"by 10.200.52.129 with SMTP id w1mr54713876qtb.77.1499266502831;        Wed, 05 Jul 2017 07:55:02 -0700 (PDT)"},{"name":"ARC-Seal","value":"i=1; a=rsa-sha256; t=1499266502; cv=none;        d=google.com; s=arc-20160816;        b=NhencNgb4bTsKr9VxgGIMQgTcpZlLAQgxZep+kbIyal0eWeqATMTFq6sr1kVBWUTgc         uyW55E6Ijx6AA9UAqxCA5fqV2vUCXy6cIGp5gFSKqCo+Ciilftem3PTuCwEgGFm820Mh         52eyk/4T8EZbEqwqOMlXfpP2IkCrnTwaFkjTmHFwCNAKs3QBSLX/KHONwXD/Y5l2ZUU9         tiNVL+vk/G7OfOqvOygynZE4DszD1glON+j6/T8T0sYwZQBtilW4admYylGb0BjmpPvK         Hm0rUC473Kbjj8v6TE5SfiyBm2nc7G/evaJAfFOXgTwrjZOWh247FuVLNaMxy6pXhSP4         ++5w=="},{"name":"ARC-Message-Signature","value":"i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=to:subject:message-id:date:from:mime-version:dkim-signature         :arc-authentication-results;        bh=bQVI6Nqv/FlhfmSoabeSC2ebzCTd6pVLsSMpaS/cfGQ=;        b=s68fqa1wyAj3TiwTzAp+y8pb4uoP4YTKHQJI7kd75S34sFgSK/I0PZQSN4Fj+UQB2y         jFV9ttIsA9pGXoHAofCN2mDChKHZJ4GmqPSq30Mty0umR2sOtjHdE26w6ZHzDnEIMs+k         hUumEGLjGx5t2PyO6ZuZ+fTHkMED2mA+K+ZFvjQF1VNdUi9dYfi9G95UD9cqG0wYDb77         bvP10oeqavepoVTJO5rjxwrwsp2OMsiGC1ef1D5Bmzj4wfKRzkNeAmcBKXjyNpsT0U4u         NqbHG3sD2yjdQbQM6NGQU4wzDggcUHhYieCSPeVO61SxwmLbOSYEDuA26A+F5wlFk2OO         T5bA=="},{"name":"ARC-Authentication-Results","value":"i=1; mx.google.com;       dkim=pass header.i=@olacabs.com header.b=aBnHl4SC;       spf=pass (google.com: domain of careers@olacabs.com designates 2607:f8b0:400d:c0d::236 as permitted sender) smtp.mailfrom=careers@olacabs.com;       dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=olacabs.com"},{"name":"Return-Path","value":"\u003ccareers@olacabs.com\u003e"},{"name":"Received","value":"from mail-qt0-x236.google.com (mail-qt0-x236.google.com. [2607:f8b0:400d:c0d::236])        by mx.google.com with ESMTPS id e34si5355924qtf.222.2017.07.05.07.55.02        for \u003cprince.soamedia@gmail.com\u003e        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);        Wed, 05 Jul 2017 07:55:02 -0700 (PDT)"},{"name":"Received-SPF","value":"pass (google.com: domain of careers@olacabs.com designates 2607:f8b0:400d:c0d::236 as permitted sender) client-ip=2607:f8b0:400d:c0d::236;"},{"name":"Authentication-Results","value":"mx.google.com;       dkim=pass header.i=@olacabs.com header.b=aBnHl4SC;       spf=pass (google.com: domain of careers@olacabs.com designates 2607:f8b0:400d:c0d::236 as permitted sender) smtp.mailfrom=careers@olacabs.com;       dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=olacabs.com"},{"name":"Received","value":"by mail-qt0-x236.google.com with SMTP id 32so79499231qtv.1        for \u003cprince.soamedia@gmail.com\u003e; Wed, 05 Jul 2017 07:55:02 -0700 (PDT)"},{"name":"DKIM-Signature","value":"v=1; a=rsa-sha256; c=relaxed/relaxed;        d=olacabs.com; s=google;        h=mime-version:from:date:message-id:subject:to;        bh=bQVI6Nqv/FlhfmSoabeSC2ebzCTd6pVLsSMpaS/cfGQ=;        b=aBnHl4SCcMXKUdX1GM9X9mnGIr6RFUubRbZpXDsqRKnSXMZTgx6tgpGyZxrraGAw+l         gwxasQwNmFA7glouZxCn4hbc7TZH1kDtZfihGaFeDDEFP56m3hdwqZthSE9RJSt50YZf         Wujdo0+ufnG9KoQxhR6VzYVyBAgsbtasN+heLoJrlGJOle7V87Dzrse01L/Mzd7okGhw         weRPhnTHFoJgt+Fq4+iQBzXJXK78zokriqqj8VwjkJYTNT5MSbbp+guUvsYVyQ1GREOl         vU8HgAfGR30hYCOmaedqvj5SIV78o9S6EI/lZbais69ekySBUUbfIkfDWfOyG99968d4         5zEg=="},{"name":"X-Google-DKIM-Signature","value":"v=1; a=rsa-sha256; c=relaxed/relaxed;        d=1e100.net; s=20161025;        h=x-gm-message-state:mime-version:from:date:message-id:subject:to;        bh=bQVI6Nqv/FlhfmSoabeSC2ebzCTd6pVLsSMpaS/cfGQ=;        b=HsgJrE0bxclebhzPqJDqqE2jEZmyz18N21psr/9ZSbIwU0NHnailZLNQWm4xa3Jevf         RT9f3HnA+t3GFNYWW6TWbBvopXQcdisxRjOrimMVZiGLfWIlJIlTYnQ/jx27p4+puV86         dIC+MdWpNoSEVZVHdwsdBkiJTwMUeglNDImeCRPbWf6SVyH2VK1AQbO14SoNmJgtP7I3         FWlYfLEI4QcygM1RAf8FJbNgsrg3lznq/CBUMICaIzJ3NwITmQwIl4hnl6yswI97uc2N         Jn0lCTCLgj6WLP1j0qKUMNOUBTTrbL7fm6HKBcqYv3EsH8gL8BMOvGY4Tljie+8W9oni         ZwDA=="},{"name":"X-Gm-Message-State","value":"AIVw111fvg5+xDxFwfDNKX2M3/aYk74TMYWBHSoMPs5P/nEWqQdsrCIi Hc2kiyjRMuKRV44ArDKraVTNioyD6uj6iQQ="},{"name":"X-Received","value":"by 10.237.32.70 with SMTP id 64mr19772614qta.218.1499266502216; Wed, 05 Jul 2017 07:55:02 -0700 (PDT)"},{"name":"MIME-Version","value":"1.0"},{"name":"Received","value":"by 10.12.146.208 with HTTP; Wed, 5 Jul 2017 07:55:01 -0700 (PDT)"},{"name":"From","value":"\"Careers .\" \u003ccareers@olacabs.com\u003e"},{"name":"Date","value":"Wed, 5 Jul 2017 20:25:01 +0530"},{"name":"Message-ID","value":"\u003cCAHd4NbdHUFDpHpVySdFQ_KVOzTZRGwpduRH8n8tnT9Euow_RhQ@mail.gmail.com\u003e"},{"name":"Subject","value":"Thank you from Ola!"},{"name":"To","value":"prince.soamedia@gmail.com"},{"name":"Content-Type","value":"multipart/alternative; boundary=\"94eb2c0c98c849f3090553932fd7\""}],"mimeType":"multipart/alternative","parts":[{"body":{"data":"RGVhciBQcmFkaXAsDQoNClRoYW5rcyBmb3IgeW91ciBpbnRlcmVzdCBpbiBPbGEgYW5kIHRha2luZyB0aW1lIG91dCB0byBhdHRlbmQgdGhlDQp0ZWxlcGhvbmljIGludGVydmlldyB3aXRoIHVzLg0KDQpXZSBjYXJlZnVsbHkgcmV2aWV3ZWQgdGhlIHJlc3VsdHMgb2YgdGhlIHRlbGVwaG9uaWMgaW50ZXJ2aWV3IGFuZCBkZWNpZGVkDQpub3QgdG8gcHJvY2VlZCB3aXRoIHlvdXIgYXBwbGljYXRpb24gYXQgdGhpcyB0aW1lIGZvciB0aGUgY3VycmVudCBvcGVuIHJvbGUuDQoNCkFsdGhvdWdoIHRoaXMgcm9sZSBkaWRuJ3Qgd29yayBvdXQsIHdlIG1heSBjb250YWN0IHlvdSBpZiB3ZSBjb21lIGFjcm9zcw0KYW5vdGhlciBvcGVuaW5nIHRoYXQgd2UgdGhpbmsgY291bGQgaW50ZXJlc3QgeW91IGFuZCBtYXkgYmUgYSBnb29kIG1hdGNoDQpmb3IgeW91ciBza2lsbHMgYW5kIGV4cGVyaWVuY2UuDQoNCldpc2ggeW91IHRoZSB2ZXJ5IGJlc3QgZm9yIHlvdXIgZnV0dXJlIGVuZGVhdm9ycy4NCg0KUmVnYXJkcywNClRlYW0gSFINCk9sYSAoQU5JIFRlY2hub2xvZ2llcyBQdnQuIEx0ZC4pDQo=","size":560},"headers":[{"name":"Content-Type","value":"text/plain; charset=\"UTF-8\""}],"mimeType":"text/plain","partId":"0"},{"body":{"data":"PGRpdiBkaXI9Imx0ciI-PGRpdiBjbGFzcz0iZ21haWxfcXVvdGUiPjxkaXYgZGlyPSJsdHIiPjxkaXYgY2xhc3M9ImdtYWlsX3F1b3RlIj48ZGl2IGRpcj0ibHRyIj48ZGl2IGNsYXNzPSJnbWFpbF9xdW90ZSI-PGRpdiBkaXI9Imx0ciI-PGRpdiBjbGFzcz0iZ21haWxfcXVvdGUiPjxkaXYgZGlyPSJsdHIiPjxkaXYgY2xhc3M9ImdtYWlsX3F1b3RlIj48ZGl2IGRpcj0ibHRyIj48ZGl2IGNsYXNzPSJnbWFpbF9xdW90ZSI-PGRpdiBkaXI9Imx0ciI-PGRpdiBjbGFzcz0iZ21haWxfcXVvdGUiPjxkaXYgZGlyPSJsdHIiPjxkaXYgY2xhc3M9ImdtYWlsX3F1b3RlIj48ZGl2IGRpcj0ibHRyIj48ZGl2IGNsYXNzPSJnbWFpbF9xdW90ZSI-PGRpdiBkaXI9Imx0ciI-PGRpdiBjbGFzcz0iZ21haWxfcXVvdGUiPjxkaXYgZGlyPSJsdHIiPjxkaXYgY2xhc3M9ImdtYWlsX3F1b3RlIj48ZGl2IGRpcj0ibHRyIj48ZGl2IGNsYXNzPSJnbWFpbF9xdW90ZSI-PGRpdiBkaXI9Imx0ciI-PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxMi44cHgiPkRlYXIgUHJhZGlwLDwvc3Bhbj48YnIgc3R5bGU9ImZvbnQtc2l6ZToxMi44cHgiPjxiciBzdHlsZT0iZm9udC1zaXplOjEyLjhweCI-PGRpdiBzdHlsZT0iZm9udC1zaXplOjEyLjhweCI-VGhhbmtzIGZvciB5b3VyIGludGVyZXN0IGluIE9sYSBhbmQgdGFraW5nIHRpbWUgb3V0IHRvIGF0dGVuZCB0aGUgdGVsZXBob25pYyBpbnRlcnZpZXcgd2l0aCB1cy4gwqA8YnI-PC9kaXY-PGRpdiBzdHlsZT0iZm9udC1zaXplOjEyLjhweCI-PGJyPjwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMi44cHgiPldlIGNhcmVmdWxseSByZXZpZXdlZCB0aGUgcmVzdWx0cyBvZiB0aGUgdGVsZXBob25pYyBpbnRlcnZpZXcgYW5kIGRlY2lkZWQgbm90IHRvIHByb2NlZWQgd2l0aCB5b3VyIGFwcGxpY2F0aW9uIGF0IHRoaXMgdGltZSBmb3IgdGhlIGN1cnJlbnQgb3BlbiByb2xlLjxicj48YnI-QWx0aG91Z2ggdGhpcyByb2xlIGRpZG4mIzM5O3Qgd29yayBvdXQsIHdlIG1heSBjb250YWN0IHlvdSBpZiB3ZSBjb21lIGFjcm9zcyBhbm90aGVyIG9wZW5pbmcgdGhhdCB3ZSB0aGluayBjb3VsZCBpbnRlcmVzdCB5b3UgYW5kIG1heSBiZSBhIGdvb2QgbWF0Y2ggZm9yIHlvdXIgc2tpbGxzIGFuZCBleHBlcmllbmNlLsKgPC9kaXY-PGRpdiBzdHlsZT0iZm9udC1zaXplOjEyLjhweCI-PGJyPjwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMi44cHgiPldpc2ggeW91IHRoZSB2ZXJ5IGJlc3QgZm9yIHlvdXIgZnV0dXJlIGVuZGVhdm9ycy48YnI-PGJyPjwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMi44cHgiPlJlZ2FyZHMsPC9kaXY-PGRpdiBzdHlsZT0iZm9udC1zaXplOjEyLjhweCI-PGZvbnQgY29sb3I9IiM2NjY2NjYiPlRlYW0gSFI8L2ZvbnQ-PC9kaXY-PGRpdiBzdHlsZT0iZm9udC1zaXplOjEyLjhweCI-PGZvbnQgY29sb3I9IiM2NjY2NjYiPk9sYSAoQU5JIFRlY2hub2xvZ2llcyBQdnQuIEx0ZC4pPC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2Pg0KPC9kaXY-DQo=","size":1658},"headers":[{"name":"Content-Type","value":"text/html; charset=\"UTF-8\""},{"name":"Content-Transfer-Encoding","value":"quoted-printable"}],"mimeType":"text/html","partId":"1"}]},"sizeEstimate":7265,"snippet":"Dear Pradip, Thanks for your interest in Ola and taking time out to attend the telephonic interview with us. We carefully reviewed the results of the telephonic interview and decided not to proceed","threadId":"15d133f50ae4d1c4"}` // Your full JSON here

	// Parse the message
	var gmailMsg gmail.Message
	if err := json.Unmarshal([]byte(messageJSON), &gmailMsg); err != nil {
		panic("failed to parse message: " + err.Error())
	}

	// Insert the message
	if err := gmailClient.InsertMessage(&gmailMsg); err != nil {
		panic("failed to insert message: " + err.Error())
	}

	logger.Info(context.Background(), "Message inserted successfully")
}
